<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Pedido</title>
    <link rel="stylesheet" href="pedidos.css">
</head>

<body>
    <div class="landing-page">
        <h1>Bienvenido a ModaVane</h1>
        <p>Crea tu pedido llenando los siguientes detalles:</p>
        <a href="pedidos.html" class="create-order-button">Crear Pedido</a>
    </div>

    <div class="order-form-container" id="orderFormContainer">
        <h2>Crear Pedido</h2>
        <div>
            <label for="userId">ID Usuario:</label>
            <input type="number" id="user_id">

            <label for="productId">ID Producto:</label>
            <input type="number" id="product_id">

            <label for="totalPrice">Precio Total:</label>
            <input type="number" id="total_price">

            <label for="status">Estado:</label>
            <select id="status">
                <option value="pendiente">Pendiente</option>
                <option value="en proceso">En Proceso</option>
            </select>

            <button onclick="crearPedido()">Crear Pedido</button>
            </div>
    </div>

    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"
        integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7/aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+"
        crossorigin="anonymous"></script>

    <script>
            const socket = io("http://localhost:3000");

            socket.on("connect", () => {
                console.log(socket.id);
            });

            socket.on("disconnect", () => {
                console.log(socket.id);
            });

            socket.on("new-order", (data) => {
                console.log(data);
            });

            socket.on("new-payment", (data) => {
                console.log("se ha procesado el pago de la orden:", data);});

            const orderResult = document.getElementById('order-result');
            const btnCreateOrder = document.getElementById('btn-crear-orden');

            function crearPedido() {
                const userId = Number(document.getElementById('user_id').value);
                const productId = Number(document.getElementById('product_id').value);
                const totalPrice = Number(document.getElementById('total_price').value);
                const status = document.getElementById('status').value;

                const order = {
                    user_id: userId,
                    product_id: productId,
                    total_price: totalPrice,
                    status: status
                };

                fetch('http://localhost:8080/orders/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(order)
                }).then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            orderResult.innerHTML = '<p>Pedido creado exitosamente!</p>';
                        } else {
                            orderResult.innerHTML = '<p>Error al crear el pedido</p>';
                        }
                    })
                    .catch(error => {
                        console.error('Error creando orden:', error);
                        orderResult.innerHTML = '<p>Error al crear el pedido pelona .</p>';
                    });
            }
</script>
</body>

</html>